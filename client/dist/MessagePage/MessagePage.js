"use strict";require("core-js/modules/es.array.iterator.js"),require("core-js/modules/es.object.to-string.js"),require("core-js/modules/es.string.iterator.js"),require("core-js/modules/es.weak-map.js"),require("core-js/modules/web.dom-collections.iterator.js"),require("core-js/modules/es.object.define-property.js"),require("core-js/modules/es.object.get-own-property-descriptor.js");var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_typeof=require("@babel/runtime/helpers/typeof");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_react=_interopRequireWildcard(require("react"));require("./MessagePage.css");var _antd=require("antd"),_icons=require("@ant-design/icons"),_axios=require("../../helpers/axios/axios"),_Pusher=require("../Pusher"),_FloatMessageArea=_interopRequireDefault(require("./FloatMessageArea")),_helpers=require("../helpers");function _getRequireWildcardCache(a){if("function"!=typeof WeakMap)return null;var b=new WeakMap,c=new WeakMap;return(_getRequireWildcardCache=function(a){return a?c:b})(a)}function _interopRequireWildcard(a,b){if(!b&&a&&a.__esModule)return a;if(null===a||"object"!==_typeof(a)&&"function"!=typeof a)return{default:a};var c=_getRequireWildcardCache(b);if(c&&c.has(a))return c.get(a);var d={},e=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in a)if("default"!=f&&Object.prototype.hasOwnProperty.call(a,f)){var g=e?Object.getOwnPropertyDescriptor(a,f):null;g&&(g.get||g.set)?Object.defineProperty(d,f,g):d[f]=a[f]}return d.default=a,c&&c.set(a,d),d}var MessagePage=function(a){var b=a.user,c=a.chat,d=a.setChat,e=a.addChatMessage,f=(0,_react.useState)(),g=(0,_slicedToArray2.default)(f,2),h=g[0],i=g[1],j=c,k=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(){var b,c;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,_axios.axiosChat.post("/getMessages",{convoId:null===(b=j.userConversation)||void 0===b?void 0:b._id});case 2:c=a.sent.data,d({messages:c});case 4:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();(0,_react.useEffect)(function(){return k(),function(){return d({messages:[],conversation:{}})}},[c.address]);// PUSHER - NEW MESSAGES
var l=(0,_react.useState)({}),m=(0,_slicedToArray2.default)(l,2),n=m[0],o=m[1];(0,_react.useEffect)(function(){n.message&&n.message._id&&e(n)},[n]),(0,_react.useEffect)(function(){var a;if(null!==(a=j.userConversation)&&void 0!==a&&a._id){var b=_Pusher.pusher.subscribe(j.userConversation._id);b.bind("new-message",function(a){return o(a.data)})}return function(){j.userConversation._id&&_Pusher.pusher.unsubscribe(j.userConversation._id)}},[j.userConversation]);// ______________________________________________________________________
var p=function(){return d({page:"mainpage"})},q=/*#__PURE__*/function(){var a=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(){return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(h){a.next=2;break}return a.abrupt("return",(0,_helpers.appMessage)("No Content"));case 2:return a.next=4,_axios.axiosChat.post("/createMessage",{address:b.address,text:h,owner:b._id,convoId:j.userConversation._id,convoIndex:j.userConversation.index||0});case 4:i("");case 5:case"end":return a.stop();}},a)}));return function(){return a.apply(this,arguments)}}();return/*#__PURE__*/_react.default.createElement("div",{className:"floatMessagePage flex flexCol"},function header(){return/*#__PURE__*/_react.default.createElement("div",{className:"flex"},/*#__PURE__*/_react.default.createElement("div",{onClick:p,className:"flex align-center hover blue bold"}))}(),/*#__PURE__*/_react.default.createElement(_FloatMessageArea.default,{chat:c,user:b}),function createMessage(){return/*#__PURE__*/_react.default.createElement("div",{className:"floatCreateMessage"},/*#__PURE__*/_react.default.createElement(_antd.Input,{value:h,onChange:function onChange(a){return i(a.target.value)},onPressEnter:q,block:"true",suffix:/*#__PURE__*/_react.default.createElement(_icons.SendOutlined,{className:"hover",onClick:q,style:{color:"var(--blue)"}}),placeholder:"Enter message..."}))}())},_default=MessagePage;exports.default=_default;